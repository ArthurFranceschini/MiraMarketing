---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/footer.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import blogData from '../../../data/blog.json';

export function getStaticPaths() {
  return blogData.posts.map(p => ({
    params: { slug: p.id }
  }));
}

const { slug } = Astro.params;
const post = blogData.posts.find(p => p.id === slug);
const lang = 'es';

if (!post) {
  return Astro.redirect('/es/blog');
}

const formattedDate = new Date(post.date).toLocaleDateString('es-ES', {
  day: '2-digit',
  month: 'long',
  year: 'numeric'
});

const isoDate = new Date(post.date).toISOString();

const breadcrumbItems = [
  { label: 'Inicio', href: `/${lang}/` },
  { label: 'Blog', href: `/${lang}/blog` },
  { label: post.name[lang] }
];

const schemaData = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://miramarketing.com/${lang}/blog/${post.id}`
  },
  "headline": post.name[lang],
  "description": post.excerpt[lang],
  "image": `https://miramarketing.com${post.image}`,
  "datePublished": isoDate,
  "dateModified": isoDate,
  "author": {
    "@type": "Organization",
    "name": "Mira Marketing",
    "url": "https://miramarketing.com"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Mira Marketing",
    "logo": {
      "@type": "ImageObject",
      "url": "https://miramarketing.com/logo.svg"
    }
  },
  "keywords": post.tags.join(", "),
  "articleSection": post.tags[0] || "Marketing",
  "inLanguage": "es-ES"
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Inicio",
      "item": `https://miramarketing.com/${lang}/`
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": `https://miramarketing.com/${lang}/blog`
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": post.name[lang],
      "item": `https://miramarketing.com/${lang}/blog/${post.id}`
    }
  ]
};
---

<Layout
  lang={lang}
  title={`${post.name[lang]} | Mira Marketing`}
  description={post.excerpt[lang]}
  image={post.image}
>
  <Header lang={lang} />
  <Breadcrumb items={breadcrumbItems} />
  
  <article 
    class="px-8 py-16 md:px-32 md:py-32 max-w-4xl mx-auto"
    itemscope
    itemtype="https://schema.org/BlogPosting"
  >
    <div class="fade-in">
      <div class="flex flex-wrap gap-2 mb-4" itemprop="keywords">
        {post.tags.map((tag) => (
          <span class="text-xs md:text-sm font-light px-3 py-1 rounded-full border border-gray-300">
            {tag}
          </span>
        ))}
      </div>
      
      <time datetime={isoDate} itemprop="datePublished" class="text-sm text-gray-500">
        {formattedDate}
      </time>
      
      <h1 class="text-2xl md:text-5xl font-bold tracking-tight mt-4" itemprop="headline">
        <span class="bg-linear-to-r from-[#0004FF] to-[#FF0A0A] bg-clip-text text-transparent">
          {post.name[lang]}
        </span>
      </h1>
      
      <figure class="mt-8">
        <img 
          src={post.image} 
          alt={post.name[lang]}
          class="w-full h-64 md:h-96 object-cover rounded-lg"
          loading="eager"
          width="1200"
          height="630"
          itemprop="image"
        />
      </figure>
      
      <div class="prose prose-lg mt-8 md:mt-16" itemprop="articleBody">
        <p class="text-sm md:text-xl leading-relaxed">{post.content[lang]}</p>
      </div>
      
      <div itemprop="author" itemscope itemtype="https://schema.org/Organization" class="sr-only">
        <span itemprop="name">Mira Marketing</span>
      </div>
    </div>
  </article>

  <Footer lang={lang} />
</Layout>

<script type="application/ld+json" set:html={JSON.stringify(schemaData)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

<style>
  .fade-in {
    opacity: 0;
    transform: translateY(2rem);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .fade-in.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  const fadeObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    },
    { threshold: 0.1 }
  );

  document.querySelectorAll('.fade-in').forEach((el) => {
    fadeObserver.observe(el);
  });
</script>